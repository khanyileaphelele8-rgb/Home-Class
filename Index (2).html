const CACHE_NAME = 'homeclass-shell-v1';
const ASSETS = [
  '/',
  '/index.html',
  '/manifest.json'
  // if you add local icons like /icon-192.png or other assets, list them here
];

// install
self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME).then(cache => cache.addAll(ASSETS))
  );
  self.skipWaiting();
});

// activate
self.addEventListener('activate', event => {
  event.waitUntil(
    caches.keys().then(keys => Promise.all(
      keys.filter(k => k !== CACHE_NAME).map(k => caches.delete(k))
    ))
  );
  self.clients.claim();
});

// fetch - cache-first for app shell, network-first for others
self.addEventListener('fetch', event => {
  const url = new URL(event.request.url);
  // offline-first for same-origin app shell requests
  if (url.origin === location.origin) {
    event.respondWith(caches.match(event.request).then(cached => cached || fetch(event.request).then(r => {
      // put in cache for next time
      return caches.open(CACHE_NAME).then(cache => { cache.put(event.request, r.clone()); return r; });
    }).catch(()=> cached) ));
  } else {
    // cross-origin: try network then fallback to cache
    event.respondWith(fetch(event.request).catch(()=> caches.match(event.request)));
  }
});